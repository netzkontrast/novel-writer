# Foreshadowing Management System

A master of Shi Zhangyu-style foreshadowing, managing a thousand-mile-long thread of clues to create an unexpected ending.

## Usage

```
/shizhangyu-foreshadow <operation> [parameters]
```

## Operation Types

- `add` - Add a new instance of foreshadowing
- `list` - View the list of foreshadowing
- `track` - Track the status of foreshadowing
- `activate` - Activate an instance of foreshadowing
- `resolve` - Resolve an instance of foreshadowing
- `analyze` - Analyze the foreshadowing layout
- `suggest` - Get suggestions for foreshadowing
- `check` - Check the logical chain

## Foreshadowing Types

### Object Foreshadowing
- Keepsakes, secret letters, tokens, maps
- Seemingly ordinary but crucial items
- The whereabouts of a lost item
- The origin of a mysterious gift

### Dialogue Foreshadowa
- Information revealed unintentionally
- Prophecies and omens
- Puns and hints
- Truths told in jest

### Event Foreshadowing
- Seemingly coincidental encounters
- Small but unusual events
- Events happening in the background
- Overlooked details

### Character Foreshadowing
- A mysterious background
- A hidden identity
- An unspoken secret
- A missing key character

## Example Usage

### Adding Foreshadowing
```
User: /shizhangyu-foreshadow add The jade pendant the protagonist found in Chapter 3

AI:
【Foreshadowing Registered Successfully】

Foreshadowing ID: F2024001
━━━━━━━━━━━━━━━━━━
Type: Object Foreshadowing
Chapter: Chapter 3
Location: Chapter 3, paragraph 15
Content: The protagonist finds a broken jade pendant on an ancient battlefield.

Detailed Description:
The material of the jade pendant is special, seemingly jade but not quite. It has half of the character "Chen" on it, and the back is engraved with a fragmented dragon pattern. The protagonist thinks it's an ordinary antique and puts it away.

Potential Directions:
1. It might be a token of the former royal family.
2. It might be proof of a key character's identity.
3. It might be the key to unlocking a secret.
4. It might be related to the protagonist's background.

Suggested Resolution Timing:
- Short-term (5-10 chapters): As proof of identity.
- Mid-term (20-30 chapters): To reveal an important clue.
- Long-term (40-50 chapters): As a key turning point item.
- Ending: As evidence of the final truth.

Related Foreshadowing:
- F2023098: The fall of the Chen Kingdom mentioned in Chapter 1.
- F2023099: The old man's words in Chapter 2, "Heaven's mandate is with Chen."

Status: Planted [Awaiting Activation]
```

### Viewing the Foreshadowing List
```
User: /shizhangyu-foreshadow list

AI:
【Foreshadowing Tracking Table】
━━━━━━━━━━━━━━━━━━

Awaiting Activation (12)
────────────────
F2024001 | Chapter 3 | Jade Pendant | Object | High Priority
F2024002 | Chapter 5 | "He's still alive" | Dialogue | Medium Priority
F2024003 | Chapter 7 | Man in Black | Character | High Priority
F2024004 | Chapter 9 | Prophetic Poem | Dialogue | Low Priority
[More...]

Activated (5)
────────────────
F2023095 | Chapter 2 | Sword Scar | Event | Activated in Chapter 15
F2023096 | Chapter 4 | Dream | Event | Activated in Chapter 18
[More...]

Resolved (8)
────────────────
F2023090 | Chapter 1 | Opening Death | Character | Identity revealed in Chapter 20
F2023091 | Chapter 1 | Secret Letter | Object | Content deciphered in Chapter 22
[More...]

Foreshadowing Network Map:
     F2024001 ─── F2023098
          ╲        ╱
           F2023099
          ╱        ╲
     F2024003 ─── F2024002

Priority Resolution Suggestions:
1. F2024001 (Jade Pendant) - Suggested to be resolved in Chapter 25.
2. F2024003 (Man in Black) - Suggested to be revealed in Chapter 28.
3. F2024002 (Dialogue) - Suggested to be referenced in Chapter 30.
```

### Activating Foreshadowing
```
User: /shizhangyu-foreshadow activate F2024001

AI:
【Foreshadowing Activation Plan】

Foreshadowing: F2024001 (Jade Pendant)
━━━━━━━━━━━━━━━━━━

Activation Scene Design:

Suggested plot for Chapter 25:

Chen Ping'an is trapped in a secret chamber in the palace. At his wit's end, he accidentally touches the jade pendant in his pocket. Suddenly, the walls of the secret chamber rumble, and a hidden door slowly opens.

"This is..." The old eunuch who followed him stared with wide eyes and said in a trembling voice, "The inheritance token of the Chen royal family! I have waited for sixty years, and I have finally waited for it!"

Activation Points:
1. Timing: When the protagonist is in a desperate situation.
2. Method: Accidental trigger.
3. Effect: Reversal of the situation.
4. Deepening: Leads to a bigger secret.

Subsequent Chain of Events:
- Reveals the protagonist's true background.
- Brings out the remaining forces of the Chen Kingdom.
- Activates F2023098, F2023099.
- Plants new foreshadowing: the price of the inheritance.

Writing Suggestion:
Don't explain everything at once; maintain the suspense. The jade pendant is just the key; the real secret is yet to come.
```

### Analyzing the Foreshadowing Layout
```
User: /shizhangyu-foreshadow analyze

AI:
【Foreshadowing Layout Analysis Report】

Overall Assessment
━━━━━━━━━━━━━━━━━━
Foreshadowing Density: 8.5/10 (Excellent)
Logical Coherence: 9/10 (Excellent)
Timeliness of Resolution: 7/10 (Good)
Surprise Level: 8/10 (Excellent)

Layout Features:
1. A good mix of long, medium, and short-term clues.
2. A balance of different types of foreshadowing.
3. Key instances of foreshadowing are interconnected.
4. The main plot's foreshadowing chain is complete.

Existing Problems:
1. Fewer instances of foreshadowing in Chapters 10-15.
2. Foreshadowing F2023094 is too obvious.
3. Some short-term foreshadowing has not been resolved in a timely manner.

Optimization Suggestions:
1. Add a medium-level instance of foreshadowing in Chapter 12.
2. Make F2023094 more subtle.
3. Resolve F2023092 and F2023093 as soon as possible.

Foreshadowing Network Health:
Core Chain: ████████░░ 85%
Branch Chains: ███████░░░ 70%
Independent Points: ████░░░░░░ 40%

Expected Effect:
With the current layout, the impact of the ending twist: ★★★★☆
Probability of readers finding Easter eggs on a second read: 95%
Logical self-consistency: 98%
```

### Getting Foreshadowing Suggestions
```
User: /shizhangyu-foreshadow suggest I need an important instance of foreshadowing for Chapter 30

AI:
【Intelligent Foreshadowing Suggestions】

Based on the current plot analysis, for Chapter 30, I suggest:

Recommended Foreshadowing Plan 1 (Optimal)
━━━━━━━━━━━━━━━━━━
Type: Character Identity Foreshadowing
Content: The mysterious merchant who has been helping the protagonist inadvertently shows a mannerism unique to the government.
Specifics: When he says goodbye, he subconsciously makes a gesture that only the imperial guards use.
Direction: This person might be a secret agent sent by the emperor.
Resolution: Reveal his true identity and purpose in Chapter 45.

Recommended Foreshadowing Plan 2
━━━━━━━━━━━━━━━━━━
Type: Dialogue Foreshadowing
Content: The antagonist says something seemingly sarcastic: "Do you think you're the first?"
Direction: Suggests that someone has walked the same path before.
Resolution: Discover in Chapter 50 that the protagonist is part of a larger plan.

Recommended Foreshadowing Plan 3
━━━━━━━━━━━━━━━━━━
Type: Event Foreshadowing
Content: A carrier pigeon flies by and drops a feather.
Direction: Someone is secretly passing messages.
Resolution: Discover the existence of an intelligence network in Chapter 40.

Connection to Existing Foreshadowing:
- Can echo F2024001.
- Enhances the mystery of F2024003.
- Lays the groundwork for the final twist.
```

## Advanced Features

### Foreshadowing Chain Design
Create a chain reaction of multiple instances of foreshadowing:
- Main Chain Foreshadowing (the core secret)
- Branch Chain Foreshadowing (supplementary information)
- Misleading Foreshadowing (to create suspense)
- Twist Foreshadowing (to subvert expectations)

### Timeline Management
Manage foreshadowing in chronological order:
- Immediate Foreshadowing (within 1-3 chapters)
- Short-term Foreshadowing (5-10 chapters)
- Mid-term Foreshadowing (15-30 chapters)
- Long-term Foreshadowing (throughout the book)

### Logic Validator
Checks the logical reasonableness of the foreshadowing:
- Is the cause-and-effect relationship valid?
- Is the chronological order reasonable?
- Is the amount of information appropriate?
- Is the timing of the resolution appropriate?

## Output Specifications

1. **Numbering System**: A unified numbering system for easy tracking.
2. **Status Markers**: To be planted/Planted/Activated/Resolved
3. **Priority Levels**: High/Medium/Low priority
4. **Association Markers**: Indicates related foreshadowing
5. **Resolution Reminders**: Suggests the best timing

## Related Commands

- `/shizhangyu-style` - Activate the style.
- `/shizhangyu-write` - Create the foreshadowing.
- `/shizhangyu-plot` - Foreshadowing and power struggles.
- `/shizhangyu-character` - Character foreshadowing.
